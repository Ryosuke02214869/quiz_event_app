# クイズアプリ 要件定義書

## 1. 概要

### 1-1. システム概要
選択問題形式のクイズの出題と回答ができるWebアプリケーション。
社内イベント等での単発利用を想定し、シンプルな構成とする。

**デバイス要件:**
- 管理画面: PC専用（デスクトップブラウザ）
- 回答者画面: モバイル専用（スマートフォン・タブレット）

### 1-2. 想定用途
- 社内イベントでのクイズ大会
- 一発屋的なアプリケーション（動作すればよい）
- 複数人が同時に回答可能

### 1-3. 技術スタック
- フロントエンド: Vue 3 + TypeScript
- バックエンド: Supabase (PostgreSQL)
- ストレージ: Supabase Storage
- 認証方式: URLパラメータによる簡易管理（ログイン機能なし）

### 1-4. ユーザー種別
- **管理者（出題者）**: 問題作成、クイズ進行管理、結果確認
- **回答者**: クイズ回答、結果確認

---

## 2. 画面設計

### 2-1. 管理画面（`?mode=admin`）

#### 2-1-1. 機能一覧
- クイズ作成・編集機能
- 問題管理機能
- クイズモード管理機能
- 正解数確認ダッシュボード
- 回答者管理機能
- デモ機能

#### 2-1-2. クイズ作成・編集機能

**問題作成フォーム**
- 問題文入力（テキストエリア）
- 問題画像追加（最大3枚）
  - Firebase Storageにアップロード
  - 画像プレビュー表示
- 選択肢作成（4択想定）
  - 各選択肢のテキスト入力
  - 各選択肢に画像を1枚追加可能
- 正解選択肢の指定（ラジオボタン）
- 正誤判定表示設定
  - 表示する/表示しない の切り替え
- 保存ボタン

**問題編集**
- 既存問題の編集フォーム表示
- 編集内容の保存

#### 2-1-3. 問題管理機能

**問題リスト表示**
- 作成した問題の一覧表示
- 各問題に以下の情報を表示
  - 問題番号
  - 問題文（一部）
  - 有効/無効ステータス
  - 正誤判定表示設定

**問題の並び替え**
- ドラッグ&ドロップで順番変更
- または上下ボタンで順番変更

**問題の有効/無効切り替え**
- トグルスイッチで即座に切り替え
- 無効の問題は回答者に表示されない

**操作ボタン**
- 「新規作成」ボタン
- 各問題の「編集」ボタン
- 各問題の「削除」ボタン（論理削除）

#### 2-1-4. クイズモード管理機能

**クイズモード設定**
- 開始ボタン
  - クイズモード開始
  - 回答者にタイトル画面から問題画面へのアクセスを許可
- 終了ボタン
  - クイズモード終了
  - 終了後も回答者は回答可能
  - 「次へ」ボタン押下時に結果画面へ遷移

**問題の有効化管理**
- 各問題をリアルタイムで有効/無効に切り替え
- 有効化された問題のみ回答者が閲覧可能
- 次の問題が有効化されていない場合、回答者の「次へ」ボタンで待機ポップアップ表示

**正誤判定表示設定**
- 問題ごとに正誤判定を表示するか設定
- 表示する: 回答履歴で正誤が確認可能
- 表示しない: 回答履歴で選択した選択肢のみ確認可能

#### 2-1-5. 正解数確認ダッシュボード

**回答者一覧**
- 回答者名
- 正解数
- 正答率（％）
- 回答数 / 総問題数
- 最終回答時刻

**リアルタイム更新**
- 回答者が回答するたびに自動更新
- ソート機能（正解数順、正答率順、名前順）

**集計情報**
- 総回答者数
- 各問題の正答率

#### 2-1-6. 回答者管理機能

**回答者追加**
- 回答者名入力フォーム
- 追加ボタン
- 追加後、固有のURLを生成（`?user=回答者名`）

**回答者削除**
- 論理削除（データは残す）
- 削除した回答者は一覧から非表示

**回答者一覧**
- 登録済み回答者の名前一覧
- 各回答者のURL表示（コピー機能付き）

#### 2-1-7. デモ機能

**プレビュー表示**
- 作成した問題を回答者画面と同じ形式で表示
- 実際の回答はデータに保存されない
- 画像の表示確認
- レイアウト確認

---

### 2-2. 回答者画面（`?user=回答者名`）

#### 2-2-1. 機能一覧
- タイトル画面
- ユーザー名表示
- クイズ回答機能
- 回答履歴確認機能
- 次の問題へ機能
- 結果画面

#### 2-2-2. タイトル画面

**表示内容**
- クイズタイトル
- 「開始を待っています」メッセージ
- 自動更新（管理者がクイズモード開始すると自動的に問題画面へ遷移）

#### 2-2-3. ユーザー名表示

**表示位置**
- 画面上部に常時表示
- URLパラメータ `?user=回答者名` から取得

#### 2-2-4. クイズ回答機能

**問題表示**
- 問題文
- 問題画像（最大3枚）
- 選択肢（4択）
  - 選択肢テキスト
  - 選択肢画像（ある場合）
- 現在の問題番号 / 総問題数

**回答方法**
- 選択肢をクリック/タップで選択
- 選択した選択肢をハイライト表示
- 「回答する」ボタン

**回答確認モーダル**
- 「回答する」ボタン押下時に表示
- 選択した選択肢を再表示
- 「確定」「キャンセル」ボタン
- 確定後は回答の修正不可

**回答後の状態**
- 「回答済み」表示
- 選択した選択肢を表示
- 「次へ」ボタン表示

#### 2-2-5. 回答履歴確認機能

**回答履歴ボタン**
- 画面上部に常時表示
- クリックでモーダル表示

**回答履歴モーダル**
- 過去に回答した問題の一覧
- 各問題に以下を表示
  - 問題番号
  - 問題文（省略形）
  - 自分が選択した選択肢
  - 正誤判定（問題設定で「表示する」の場合のみ）
    - ○: 正解
    - ×: 不正解
- 正誤判定が「表示しない」設定の問題は選択肢のみ表示

#### 2-2-6. 次の問題へ機能

**次へボタン**
- 回答後に表示
- クリックで次の問題へ遷移

**次の問題が無効の場合**
- ポップアップ表示
  - 「次の問題はまだ出題されていません」
  - 「少々お待ちください」
- 自動リロード機能（問題が有効化されたら自動で遷移）

**次の問題が存在しない場合（最終問題）**
- クイズモードが終了している場合: 結果画面へ遷移
- クイズモードが継続中の場合: 待機ポップアップ表示

#### 2-2-7. 結果画面

**表示内容**
- 「お疲れ様でした」メッセージ
- 自分の成績
  - 正解数 / 総問題数
  - 正答率（％）
- 全問題の回答結果一覧
  - 問題番号
  - 問題文（省略形）
  - 自分が選択した選択肢
  - 正解の選択肢
  - 正誤判定（○×）

**ランキング表示（オプション）**
- 全回答者の順位
- 上位3名をハイライト

---

## 3. データ構造

### 3-1. Supabase Database (PostgreSQL)

#### 3-1-1. questions（問題テーブル）
```sql
CREATE TABLE questions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  order_num INTEGER NOT NULL,
  text TEXT NOT NULL,
  images TEXT[] DEFAULT '{}',
  options JSONB NOT NULL,
  correct_answer INTEGER NOT NULL,
  show_correct_answer BOOLEAN DEFAULT true,
  is_active BOOLEAN DEFAULT false,
  is_deleted BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**options JSONB例:**
```json
[
  {
    "text": "選択肢1",
    "image": "https://supabase.storage/..."
  },
  {
    "text": "選択肢2",
    "image": null
  }
]
```

#### 3-1-2. quiz_mode（クイズモード状態テーブル）
```sql
CREATE TABLE quiz_mode (
  id INTEGER PRIMARY KEY DEFAULT 1,
  is_active BOOLEAN DEFAULT false,
  started_at TIMESTAMP WITH TIME ZONE,
  ended_at TIMESTAMP WITH TIME ZONE,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  CONSTRAINT single_row CHECK (id = 1)
);
```

#### 3-1-3. users（回答者テーブル）
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL UNIQUE,
  is_deleted BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 3-1-4. responses（回答テーブル）
```sql
CREATE TABLE responses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  question_id UUID NOT NULL REFERENCES questions(id),
  selected_answer INTEGER NOT NULL,
  is_correct BOOLEAN NOT NULL,
  answered_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, question_id)
);
```

### 3-2. Supabase Storage

#### バケット構造
```
quiz-images (Public Bucket)
  /questions
    /{questionId}
      /main
        /{timestamp}-image1.jpg
        /{timestamp}-image2.jpg
      /options
        /{timestamp}-option1.jpg
        /{timestamp}-option2.jpg
```

---

## 4. 機能要件詳細

### 4-1. URLパラメータ仕様

| パラメータ | 値 | 説明 |
|----------|-----|------|
| mode | admin | 管理画面を表示 |
| user | {回答者名} | 回答者画面を表示 |

**アクセス例**
- 管理画面: `https://example.com/?mode=admin`
- 回答者画面: `https://example.com/?user=山田太郎`

### 4-2. 画像アップロード仕様

**対応形式**
- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- WebP (.webp)

**サイズ制限**
- 1ファイルあたり最大5MB
- 推奨サイズ: 1920x1080px以下

**アップロード処理**
1. クライアント側で画像選択
2. プレビュー表示
3. Firebase Storageにアップロード
4. 取得したURLをRealtime Databaseに保存

### 4-3. リアルタイム同期仕様

**同期対象**
- 問題の有効/無効状態
- クイズモードの開始/終了状態
- 回答者の回答データ
- 回答者の追加/削除

**同期方法**
- Firebase Realtime Databaseのリスナー機能を使用
- データ変更時に自動的に全クライアントに反映

### 4-4. 回答の流れ

1. 回答者がURLにアクセス（タイトル画面表示）
2. 管理者がクイズモード開始
3. 管理者が問題1を有効化
4. 回答者に問題1が表示される
5. 回答者が選択肢を選択し「回答する」
6. 確認モーダルで「確定」
7. 回答がFirebaseに保存
8. 管理者のダッシュボードに即座に反映
9. 回答者が「次へ」をクリック
10. 問題2が有効化されていない場合はポップアップ表示
11. 管理者が問題2を有効化
12. 回答者が再度「次へ」をクリックし問題2へ遷移
13. 全問題終了後、「次へ」で結果画面へ

### 4-5. エラーハンドリング

**想定されるエラー**
- ネットワーク接続エラー
- Firebase接続エラー
- 画像アップロードエラー
- データ保存エラー

**対応方針**
- エラーメッセージをユーザーに表示
- リトライボタンの提供
- ローカルストレージへの一時保存（オプション）

---

## 5. 非機能要件

### 5-1. パフォーマンス
- ページ読み込み: 3秒以内
- 回答送信: 1秒以内
- リアルタイム同期遅延: 2秒以内

### 5-2. 対応ブラウザ
- Google Chrome（最新版）
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）

### 5-3. 対応デバイス

**管理画面（PC専用）:**
- PC（デスクトップ）
- 最小推奨解像度: 1024x768px
- 最適解像度: 1920x1080px以上

**回答者画面（モバイル専用）:**
- スマートフォン（縦向き）
- タブレット
- 対応画面幅: 320px〜768px
- モバイルファーストデザイン

### 5-4. セキュリティ
- Firebase Realtime Databaseのセキュリティルール設定
- URLパラメータによる簡易的なアクセス制御
- 画像のContent-Type検証

---

## 6. 制約事項

### 6-1. Supabase無料枠
- データベース: 500MB
- ストレージ: 1GB
- 帯域幅: 5GB/月（データベース + ストレージ）
- 同時接続: 500 (Auto-pause after 1 week of inactivity)

### 6-2. 機能制約
- ログイン機能なし
- 回答の修正不可
- 問題の削除は論理削除のみ

### 6-3. 運用制約
- イベント終了後はSupabaseプロジェクトを削除推奨
- 同時接続は100名程度を想定
- 画像は5MB以下に制限

---

## 7. 今後の拡張可能性（オプション）

- ログイン機能の追加
- 問題形式の追加（記述式、複数選択など）
- 制限時間機能
- リアルタイムランキング表示
- 問題のカテゴリ分け
- CSVによる問題一括インポート
- 結果のCSVエクスポート

---

## 8. 開発スケジュール（想定）

| フェーズ | 作業内容 | 所要時間 |
|---------|---------|---------|
| 環境構築 | Firebase設定、Vue3プロジェクト作成 | 1-2時間 |
| 管理画面 | 問題作成・管理機能 | 3-4時間 |
| 回答者画面 | 回答機能、履歴表示 | 2-3時間 |
| リアルタイム同期 | Firebase連携実装 | 2-3時間 |
| デザイン調整 | UI/UX改善 | 1-2時間 |
| テスト | 動作確認、バグ修正 | 1-2時間 |
| **合計** | | **約1日（8-12時間）** |

---

## 9. 参考資料

- Supabase公式ドキュメント: https://supabase.com/docs
- Vue 3公式ドキュメント: https://vuejs.org/
- TypeScript公式ドキュメント: https://www.typescriptlang.org/docs/